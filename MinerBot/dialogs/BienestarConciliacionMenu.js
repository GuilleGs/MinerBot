// dialogs/BienestarConciliacionMenu.js
const { MessageFactory } = require('botbuilder');
const content = require('./content');

const bienestarOptions = [
    'Programas de bienestar f√≠sico y psicol√≥gico',
    'Iniciativas de conciliaci√≥n vida-trabajo',
    'Programas Internos üè†',
    'Apoyo Familiar üë®‚Äçüë©‚Äçüëß‚Äçüë¶'
];

class BienestarConciliacionMenu {
    constructor(bot) {
        this.bot = bot;
    }

    async show(context) {
        await context.sendActivity(
            MessageFactory.suggestedActions(bienestarOptions.concat(['Volver']), 'üè† Bienestar y Conciliaci√≥n')
        );
    }

    async handleInput(context, text, conversationData, bot) {
        const lower = text.toLowerCase();

        if (conversationData.isInInfoDisplayState && lower.includes('volver')) {
            conversationData.isInInfoDisplayState = false;
            await this.show(context);
            return true;
        }

        if (lower.includes('volver')) {
            await bot.goBack(context, conversationData);
            return true;
        }

        if (lower.includes('programas internos')) {
            await bot.navigateToMenu(context, conversationData, 'programasInternos');
            return true;
        } else if (lower.includes('apoyo familiar')) {
            await bot.navigateToMenu(context, conversationData, 'apoyoFamiliar');
            return true;
        }

        const matchedOption = bienestarOptions.find(opt => opt.toLowerCase() === lower);

        if (matchedOption) {
            const response = content[lower];
            if (response) {
                await context.sendActivity(response);
            } else {
                await context.sendActivity(`Has seleccionado: "${text}" (No hay informaci√≥n detallada a√∫n).`);
            }
            conversationData.isInInfoDisplayState = true;
            return true;
        }

        return false;
    }
}

module.exports = BienestarConciliacionMenu;